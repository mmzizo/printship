{% extends 'layout.html' %}
{% block content %}

<div class="card column is-one-third">
    <div class="card-image">
        <figure class="image is-5by4">
            <img src="{{url_for('static', filename='design_pics/' + post.image_file)}}" alt="Placeholder image">
        </figure>
    </div>
    <div class="card-content">
        <div class="media">
            <div class="media-left">
                <figure class="image is-rounded is-48x48">
                    <img class="is-rounded" src="{{ url_for('static', filename='profile_pics/' + post.author.image_file)}}"
                        alt="Placeholder image">
                </figure>
            </div>
            <div class="media-content">
                <a class="title is-5">{{post.title}}</a><br>
                <a class="subtitle is-6" href="{{url_for('user_posts', username=post.author.username)}}">@{{post.author.username}}</a><br>
                {% if post.author == current_user %}
                    <button class="button is-small is-danger"id="btn">Delete</button>
                    <a href="{{url_for('update_post' , post_id = post.id)}}"><button class="button is-small is-warning">Update</button></a>
                {% endif %}
            </div>
        </div>
        <div class="content">
            {{post.caption}}
            <br>
            <time datetime="">{{post.date_posted.strftime('%d %b , %H:%M')}}</time>
            <br>
            <p>total orders {{orders.total}}</p>
        </div>
    </div>
    <footer class="card-footer">
        <a href="{{url_for('share_post',post_id=post.id)}}" class="card-footer-item">
            <span class="icon">
              <i class="fas fa-share-alt-square"></i>
            </span> Share</a>
          <a href="{{url_for('order_post',post_id=post.id)}}" class="card-footer-item">
            <span class="icon">
              <i class="fas fa-cart-plus"></i>
            </span> Order now</a>
    </footer>
</div>



<div class="modal" id="myModal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head is-danger">
        <p class="modal-card-title is-danger">Delete post</p>
        <button class="delete" aria-label="close" data-bulma-modal="close"></button>
      </header>
      <section class="modal-card-body">
        <h2 class="title is-4">This post will be Deleted permenantly</h2>
        <h6 class="subtitle is-6">are you sure you want to delete this post</h6>
      </section>
      <footer class="modal-card-foot field is-grouped is-grouped-right">
        <form action="{{url_for('delete_post' , post_id = post.id)}}" method="post"><button class="button is-danger">Delete</button></form>
        <button class="button" data-bulma-modal="close">Cancel</button>
      </footer>

    </div>
  </div>

<script>
    class BulmaModal {
        constructor(selector) {
            this.elem = document.querySelector(selector);
            this.close_data();
        }
    
        show() {
            this.elem.classList.toggle("is-active");
            this.on_show();
        }
    
        close() {
            this.elem.classList.toggle("is-active");
            this.on_close();
        }
    
        close_data() {
            var modalClose = this.elem.querySelectorAll(
                "[data-bulma-modal='close'], .modal-background"
            );
            var that = this;
            modalClose.forEach(function (e) {
                e.addEventListener("click", function () {
                    that.elem.classList.toggle("is-active");
    
                    var event = new Event("modal:close");
    
                    that.elem.dispatchEvent(event);
                });
            });
        }
    
        on_show() {
            var event = new Event("modal:show");
    
            this.elem.dispatchEvent(event);
        }
    
        on_close() {
            var event = new Event("modal:close");
    
            this.elem.dispatchEvent(event);
        }
    
        addEventListener(event, callback) {
            this.elem.addEventListener(event, callback);
        }
    }
    
    var btn = document.querySelector("#btn");
    var mdl = new BulmaModal("#myModal");
    
    btn.addEventListener("click", function () {
        mdl.show();
    });
    
    mdl.addEventListener("modal:show", function () {
        console.log("opened");
    });
    
    mdl.addEventListener("modal:close", function () {
        console.log("closed");
    });
    
</script>

{% endblock content %}